require 'rubygems'
require 'bundler'

begin
  Bundler.setup(:default, :development, :test)
rescue Bundler::BundlerError => e
  $stderr.puts e.message
  $stderr.puts "Run `bundle install` to install missing gems"
  exit e.status_code
end

require 'rake'
require 'rspec/core'
require 'rspec/core/rake_task'

RSpec::Core::RakeTask.new(:spec) do |spec|
  # do not run integration tests, doesn't work on TravisCI
  spec.pattern = FileList['spec/api/*_spec.rb']
end

task :default do
  exec "rake -T"
end

namespace :start do
  desc "Start :development environment"
  task :dev do
    system "bundle exec guard"
  end

  desc "Start :production environment"
  task :prod do
    system "RACK_ENV=production rackup"
  end
end


namespace :db do
  desc "db create"
  task :up do
    system "dropdb piecemaker2_test"
    system "createdb piecemaker2_test"
    system "psql -h localhost -d piecemaker2_test -U mattes -f db/postgresql_piecemaker2_test.sql"
  end
end

